memory_system = MemorySystem()


offline_llm_model_instance = ZICBrain() # This is the offline LLM handler (llama3 model)
online_llm_model_instance = ZIC_Online(api_key=MY_KEY) # This is the online LLM handler (Gemini)


class LLMAdapter:
    def __init__(self, online_instance, offline_instance):
        self.online_instance = online_instance
        self.offline_instance = offline_instance

    def ask(self, user_question: str, context_dict: dict, mode: str = "online") -> str:
        print(f"DEBUG: LLMAdapter.ask called with mode='{mode}' (type: {type(mode)}) - user_question: {user_question[:30]}...") # Debug print
        if mode == "online":
            print("DEBUG: Entering online branch.") # Debug print
            return self.online_instance.generate_response(prompt=user_question, context=context_dict)
        elif mode == "offline":
            print("DEBUG: Entering offline branch.") # Debug print
            return self.offline_instance.ask_zic(user_question)
        else:
            print(f"DEBUG: Entering else branch (mode not recognized): '{mode}'.") # Debug print
            return "âš ï¸ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­ ÙÙŠ LLMAdapter!"



main_brain_orchestrator = ZICBRAIN(memory_system)

adapted_llm_dispatcher = LLMAdapter(online_llm_model_instance, offline_llm_model_instance)

print("ğŸ‘‹ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… ZIC Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„!")
print("ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† ÙˆØ¶Ø¹ 'online' Ùˆ 'offline'.")
print("Ø§ÙƒØªØ¨ 'Ø®Ø±ÙˆØ¬' Ù„Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©.")

while True:
    user_question = input("Ø£Ù†Øª: ").strip()

    if user_question.lower() in ["Ø®Ø±ÙˆØ¬", "exit", "Ø¨Ø§ÙŠ"]:
        print("ğŸ‘‹ ØªÙ… Ø§Ù„Ø®Ø±ÙˆØ¬. Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø©!")
        break

    if not user_question: # Handle empty input
        continue

    current_mode_input = input("ØªØ­Ø¨ ØªØ³Ø£Ù„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ (online/offline)ØŸ ").strip().lower()

    actual_mode_for_adapter = ""
    if current_mode_input in ["online", "Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†", "on"]:
        actual_mode_for_adapter = "online"
    elif current_mode_input in ["offline", "Ø§ÙˆÙÙ„Ø§ÙŠÙ†", "off"]:
        actual_mode_for_adapter = "offline"
    else:
        print("âš ï¸ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆØ¯ÙŠÙ„ ØºÙŠØ± ØµØ§Ù„Ø­. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨ÙŠÙ† 'online' Ø£Ùˆ 'offline'.")
        continue

    print(f"ğŸŒ Ø¬Ø§Ø±ÙŠ Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ ({actual_mode_for_adapter})...")

    reply = main_brain_orchestrator.handle(user_question, adapted_llm_dispatcher, actual_mode_for_adapter)

    speak(f"ZIC: {reply}")
